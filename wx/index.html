<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- Primary Meta Tags -->
        <title>WeatherLog</title>
        <meta name="title" content="Stacja Meteorologiczna" />
        <meta name="description" content="Amatorska stacja meteorologiczna we Wrocławiu." />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content="wojtasss298.github.io/wx" />
        <meta property="og:title" content="Stacja Meteorologiczna" />
        <meta property="og:description" content="Amatorska stacja meteorologiczna we Wrocławiu." />

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image" />
        <meta property="twitter:url" content="wojtasss298.github.io/wx" />
        <meta property="twitter:title" content="Stacja Meteorologiczna" />
        <meta property="twitter:description" content="Amatorska stacja meteorologiczna we Wrocławiu." />

        <!-- Meta Tags Generated with https://metatags.io -->
        <link rel="icon" type="image/x-icon" href="./icon.png">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    </head>
    <body class="theme-dark">
        <div class="wrapper">
            <div class="page-wrapper">
                <div class="container-xl">
                    <div class="page-header d-print-none">
                        <div class="row align-items-center">
                            <div class="col">
                                <div class="page-pretitle">
                                    Przegląd
                                </div>
                                <h2 class="page-title">
                                    Wrocław, Polska,&nbsp;<span id="time-utc"></span><span style="font-size: 12px">(CEST)</span>
                                </h2>
                            </div>

                            <div class="col-auto ms-auto d-print-none">
                                
                                    <a href="./168.html" class="btn">
                                      Wykres 168h
                                    </a>
                                  
                              </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-body">
                <div class="container-xl">
                    <div class="row row-deck row-cards">

                        <div class="col-sm-6 col-lg-3">
                            <div class="card">
                                <div class="card-body">

                                    <div class="d-flex align-items-center">
                                        <div class="subheader">Temperatura</div>
                                    </div>
                                    <div class="h1 mb-3"><span id="temp"></span>&deg;C</div>

                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-lg-3">
                            <div class="card">
                                <div class="card-body">

                                    <div class="d-flex align-items-center">
                                        <div class="subheader">Wilgotność powietrza</div>
                                    </div>
                                    <div class="h1 mb-3"><span id="hum"></span>%</div>

                                </div>
                            </div>
                        </div>


                        <div class="col-sm-6 col-lg-3">
                            <div class="card">
                                <div class="card-body">

                                    <div class="d-flex align-items-center">
                                        <div class="subheader">Najcieplej <span id="maxTime"></span></div>
                                    </div>
                                    <div class="h1 mb-3"><span id="maxTemp"></span>&deg;C</div>

                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-lg-3">
                            <div class="card">
                                <div class="card-body">

                                    <div class="d-flex align-items-center">
                                        <div class="subheader">Najzimniej <span id="minTime"></span></div>
                                    </div>
                                    <div class="h1 mb-3"><span id="minTemp"></span>&deg;C</div>

                                </div>
                            </div>
                        </div>

                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="subheader">Ostatnie 24h</h3>
                                    <div>
                                        <canvas id="canvas"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>   

                            <div class="col-sm-9 col-md-9 col-lg-9">
                                <div class="card">
                                    <div class="card-body">
                                        <h3 class="subheader">Stacja</h3>
                                        <div>
                                            <p>
                                                Amatorska stacja pogodowa oparta o czujnik DHT11, proste api w express.js, bazę danych, oraz mikrokontroler NodeMcu v3. Całość zamontowana na maszcie, zamknięta w hermetycznej obudowie. Sensor zainstalowany został we własnoręcznie wykonanej osłonie przeciwsłonecznej.
                                            </p>
                                            <p>
                                                Planowana jest stała rozbudowa o kolejne czujniki oraz wykresy z wyborem przedziałów czasowych.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>   

                        <div class="col-sm-3 col-lg-3 col-md-3">
                            <div class="card">
                                <a href="https://frog01-30507.wykr.es/upload/IMG_20240320_122720.jpg" title="Kliknij aby powiększyć">
                                    <img style="padding: 2px; border-radius: 4px" alt="Stacja" src="https://frog01-30507.wykr.es/upload/IMG_20240320_122720.jpg"/>
                                </a>
                            </div>
                        </div>

                        <div class="col-sm-9 col-lg-9">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="subheader">DevLog</div>
                                    </div>
                                    <ol reversed="reversed">
                                        <li>
                                            <p>
                                                <b>Online</b> - 14.09.2024<br/>
                                                Po ponad miesiącu nieobecności stacja znów jest online. Poprawiono wyświetlanie guzików w wersji mobilnej, dodano uptime serwera.
                                            </p>
                                        </li>
                                        <li>
                                            <p>
                                                <b>Najcieplej/Najzimniej</b> - 29.04.2024<br/>
                                                Najwieksza i najmniejsza temperatura zanotowana w ciągu ostatnich 24h. Dodano wykres ostatnich 168h.
                                            </p>
                                        </li>
                                        <li>
                                            <p>
                                                <b>Wykres</b> - 20.04.2024<br/>
                                                Wprowadzono wykres z danymi z ostatnich 24 godzin. Od teraz stacja wysyła dane o równych godzinach, w odstępach dziesięcio minutowych (:00, :10, :20, :30, :40, :50).
                                            </p>
                                        </li>
                                        <li>
                                            <p>
                                                <b>Rozbudowa</b> - 22.03.2024<br/>
                                                Rozbudowano stronę internetową o opis stacji, statystyki, godzinę ostatniego pomiaru oraz kartę kontakt.
                                            </p>
                                        </li>
                                        <li>
                                            <p>
                                                <b>Montaż stacji w przejściowym miejscu.</b> - 20.03.2024<br/>
                                                Po długim czasie czujnik został zamontowany w docelowej obudowie, niestety nie w miejscu docelowym.
                                                <br/>
                                            </p>
                                        </li>
                                        <li>
                                            <p>
                                                <b>Uruchomienie stacji</b> - 10.01.2024<br/>
                                                Uruchomienie testowej konfiguracji stacji wraz z prostym api. Stworzenie prostego widoku HTML do testów.
                                            </p>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>


                        <div class="col-sm-3 col-lg-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="subheader">Statystyki</div>
                                    </div>
                                    <div class="mb-3">
                                        <ul>
                                            <li>Wysłano <b><span id="stat-post"></span></b> razy.</li>
                                            <li>Otworzono <b><span id="stat-get"></span></b> razy.</li>
                                            <li>Rozmiar danych: <b><span id="stat-size"></span></b></li>
                                            <li>Załadowania widżetu: <b><span id="stat-widget"></span></b></li>
                                            <li>Załadowania wykresu: <b><span id="zaladowaniaWykresu"></span></b></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-12 col-lg-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="subheader">uptime serwera</div>
                                    </div>
                                    <div class="mb-3">
                                        <script type="text/javascript" src="https://static.hetrix.io/iframeResizer/iframeResizer.min.js"></script>
<iframe class="htframe" src="https://wl.hetrixtools.com/report/uptime/3a17aa4ae4ddc583a029bd90673cd8f8/" width="100%" scrolling="no" style="border:none;" sandbox="allow-scripts allow-same-origin allow-popups" onload="iFrameResize([{log:false}],'.htframe')"></iframe>                                     
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-12 col-lg-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="subheader">kontakt</div>
                                    </div>
                                    <div class="mb-3">
                                        <ul>
                                            <li>Adres e-mail: <a href="mailto:" title="Wyślij wiadomość e-mail">wojtasss298@gmail.com</a></li>
                                            <li>Discord: wojtasss298</li>
                                        </ul>                                      
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <footer class="footer footer-transparent d-print-none">
                    <div class="container">
                        <div class="row text-center align-items-center flex-row-reverse">
                            <!--<div class="col-lg-auto ms-lg-auto">
                                <ul class="list-inline list-inline-dots mb-0">
                                    <li class="list-inline-item"><a href="#" class="link-secondary">Home</a></li>
                                    <li class="list-inline-item"><a href="#" class="link-secondary">About</a></li>
                                    <li class="list-inline-item"><a href="#" class="link-secondary">DevLog</a></li>
                                    <li class="list-inline-item"><a href="#" class="link-secondary">Status</a></li>
                                    <li class="list-inline-item"><a href="#" class="link-secondary">Contact</a></li>
                                    <li class="list-inline-item"><a href="#" class="link-secondary">FAQ</a></li>
                                    <li class="list-inline-item"><a href="#" class="link-secondary">Docs</a></li>
                                </ul>
                            </div>-->
                            <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                                <ul class="list-inline list-inline-dots mb-0">
                                    <li class="list-inline-item">wojtasss298 &copy; 2022 - <script>document.write(new Date().getFullYear())</script></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script>

            

            var stats = "https://frog01-20507.wykr.es/stats";
            $.getJSON(stats, function (response) {
                let zaladowaniaWykresu = response["GET /get/last/24 200"] + response["GET /get/last/24 429"] + response["GET /get/last/24 304"]
                document.getElementById("zaladowaniaWykresu").innerHTML = zaladowaniaWykresu;
                document.getElementById("stat-post").innerHTML = response["POST /post/data 201"];
                document.getElementById("stat-get").innerHTML = response["GET /stats/ 200"];
                document.getElementById("stat-widget").innerHTML = response["GET /get/datatxt 200"];

                let bajty = response["POST /post/data 201"]*60;

                if (bajty<1024){
                    let size = bajty.toFixed(2) + "B"
                    document.getElementById("stat-size").innerHTML = size;
                } else if (bajty<1024*1024){
                    let size = (bajty/1024).toFixed(2) + "KB"
                    document.getElementById("stat-size").innerHTML = size;
                } else if (bajty<1024*1024*1024){
                    let size = (bajty/1024/1024).toFixed(2) + "MB"
                    document.getElementById("stat-size").innerHTML = size;
                } else if (bajty<1024*1024*1024*1024){
                    let size = (bajty/1024/1024/1024).toFixed(2) + "GB"
                    document.getElementById("stat-size").innerHTML = size;
                } 
 
            })
           
            async function loadChart() {
                var url = "https://frog01-20507.wykr.es/get/last/24";

                $.getJSON(url, function (response) {
                    var labels = response.last24.map(function (e) {
                        var date = new Date(e.epoch * 1000);
                        var hours = date.getHours();
                        var minutes = "0" + date.getMinutes();
                        var formattedTime = hours + ':' + minutes.substr(-2);
                        return formattedTime;
                    });


                    /*NAJNOWSZE=DANE=========================================================================================*/
                    document.getElementById("temp").innerHTML = Number(response.last.temp);
                    document.getElementById("hum").innerHTML = Number(response.last.humidity);

                    //czas
                    var dataOstatni = new Date(response.last.epoch * 1000);
                    var hoursOstatni = dataOstatni.getHours();
                    var minutesOstatni = "0" + dataOstatni.getMinutes();
                    var formattedTimeOstatni = hoursOstatni + ':' + minutesOstatni.substr(-2);

                    document.getElementById("time-utc").innerHTML = formattedTimeOstatni;

                    /*NAJMNIEJSZA=I=NAJWIEKSZA=TEMPERATURA===================================================================*/
                    
                    function formatDate(dateString) {
  const date = new Date(dateString);
  
  const day = String(date.getUTCDate()).padStart(2, '0');
  const month = String(date.getUTCMonth() + 1).padStart(2, '0');
  const year = String(date.getUTCFullYear()).slice(-2); // Zmieniamy rok na dwie ostatnie cyfry
  const hours = String(date.getUTCHours()).padStart(2, '0');
  const minutes = String(date.getUTCMinutes()).padStart(2, '0');
  
  return `${day}.${month}.${year} ${hours}:${minutes}`;
}

function findExtremeTemperatures(data) {
  // Dołączamy obiekt 'last' do listy 'last24'
  const allData = [data.last, ...data.last24];

  // Inicjalizujemy zmienne do przechowywania informacji o najcieplejszej i najzimniejszej temperaturze
  let hottest = allData[0];
  let coldest = allData[0];

  // Iterujemy po wszystkich danych w celu znalezienia najcieplejszej i najzimniejszej temperatury
  allData.forEach(record => {
    if (record.temp > hottest.temp) {
      hottest = record;
    }
    if (record.temp < coldest.temp) {
      coldest = record;
    }
  });

  return {
    hottest: {
      temperature: hottest.temp,
      time: formatDate(hottest.time)
    },
    coldest: {
      temperature: coldest.temp,
      time: formatDate(coldest.time)
    }
  };
}

// Wywołanie funkcji i wyświetlenie wyników
const extremes = findExtremeTemperatures(response);
console.log('Najcieplejsza temperatura:', extremes.hottest);
console.log('Najzimniejsza temperatura:', extremes.coldest);


                    
document.getElementById("minTemp").innerHTML = extremes.coldest.temperature;
document.getElementById("minTime").innerHTML = extremes.coldest.time;

document.getElementById("maxTemp").innerHTML = extremes.hottest.temperature;
document.getElementById("maxTime").innerHTML = extremes.hottest.time;

                      
                    
                    var data1 = response.last24.map(function (e) {
                        return e.temp;
                    });

                    var data2 = response.last24.map(function (e) {
                        return e.humidity;
                    });

                    var ctx = canvas.getContext("2d");
                    var config = {
                        type: "line",
                        responsive: true,
                        options: {
                        animation: false,
                        spanGaps: true,
                        datasets: {
                            line: {
                                pointRadius: 0 // disable for all `'line'` datasets
                            }
                        },
                        elements: {
                            point: {
                                radius: 0 // default to disabled in all datasets
                            }
                        }
                    },
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: "Temperatura",
                                    data: data1,
                                    borderColor: "rgba(0, 119, 204, 1)",
                                    fill: false,
                                    borderWidth: 5,
                                },
                                {
                                    label: "Wilgotność",
                                    data: data2,
                                    borderColor: "rgba(237, 25, 9, 1)",
                                    fill: false,
                                    borderWidth: 5,
                                },
                            ],
                        },
                    };

                    var chart = new Chart(ctx, config);
                });
            }

            window.onload = loadChart();
        </script>
    </body>
</html>
